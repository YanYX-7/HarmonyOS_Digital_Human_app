import router from '@ohos.router';

@Entry
@Component
struct PersonalCustomPage {
  @State name: string = '';
  @State description: string = '';
  @State avatarUri: string = ''; // å­˜å‚¨ç”¨æˆ·é€‰æ‹©çš„å›¾ç‰‡URI

  build() {
    Column() {
      // é¡¶éƒ¨æ ‡é¢˜æ 
      Row() {
        Image($r('app.media.personal_back'))
          .width(60)
          .height(56)
          .onClick(() => {
            router.back();
          })

        Text('å®šåˆ¶æˆ‘çš„æ•°å­—äºº')
          .fontSize(20)
          .fontWeight(FontWeight.Medium)
          .fontColor(Color.White)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)

        Row().width(24).height(24)
      }
      .width('100%')
      .height(56)
      .padding({ left: 20, right: 20 })
      .backgroundColor('#ff6768d6')

      // ä¸»å†…å®¹åŒºï¼ˆå¯æ»šåŠ¨ï¼‰
      Scroll() {
        Column() {
          // å¤´åƒä¸Šä¼ åŒº
          Column() {
            // å¤´åƒé¢„è§ˆ/ä¸Šä¼ æŒ‰é’®
            Stack() {
              if (this.avatarUri) {
                // å¦‚æœå·²é€‰æ‹©å›¾ç‰‡ï¼Œæ˜¾ç¤ºé¢„è§ˆ
                Image(this.avatarUri)
                  .width(200)
                  .height(200)
                  .borderRadius(20)  // å°åœ†è§’
                  .objectFit(ImageFit.Cover)
              } else {
                Column() {
                  Image($r('app.media.people_4')) // ç›¸æœºå›¾æ ‡
                    .width(40)
                    .height(40)
                    .fillColor('#999999')

                  Text('ç‚¹å‡»æ·»åŠ å½¢è±¡')
                    .fontSize(14)
                    .fontColor('#999999')
                    .margin({ top: 8 })
                }
                .width(200)
                .height(100)
                .borderRadius(10)  // å°åœ†è§’çŸ©å½¢
                .borderRadius(60)
                .backgroundColor('#f5f5f5')
                .justifyContent(FlexAlign.Center)
              }
            }
            .border({ width: 4, color: Color.White })
            .borderRadius(60)
            .shadow({ radius: 16, color: '#33000000' })
            .onClick(() => {
              // æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨
              this.selectImage();
            })

            // æ“ä½œæç¤º
            Row() {
              Button('ğŸ“· æ‹ç…§')
                .fontSize(14)
                .fontColor('#6366f1')
                .backgroundColor('#e0e7ff')
                .height(36)
                .borderRadius(18)
                .margin({ right: 12 })
                .onClick(() => {
                  this.takePhoto();
                })

              Button('ğŸ–¼ï¸ ç›¸å†Œ')
                .fontSize(14)
                .fontColor('#6366f1')
                .backgroundColor('#e0e7ff')
                .height(36)
                .borderRadius(18)
                .onClick(() => {
                  this.selectImage();
                })
            }
            .margin({ top: 16 })
          }
          .width('100%')
          .padding(32)
          .backgroundColor(Color.White)
          .borderRadius(16)
          .margin({ top: 20 })

          // åç§°è¾“å…¥å¡ç‰‡
          Column() {
            Text('æ•°å­—äººåç§°')
              .fontSize(14)
              .fontColor('#999999')
              .width('100%')
              .margin({ bottom: 8 })

            TextInput({ placeholder: 'ä¾‹å¦‚ï¼šå°æ™ºåŠ©æ‰‹' })
              .backgroundColor('#f5f5f5')
              .borderRadius(8)
              .height(48)
              .onChange((value: string) => {
                this.name = value;
              })
          }
          .width('100%')
          .padding(20)
          .backgroundColor(Color.White)
          .borderRadius(16)
          .margin({ top: 16 })
          .alignItems(HorizontalAlign.Start)

          // æè¿°è¾“å…¥å¡ç‰‡
          Column() {
            Text('è§’è‰²æè¿°')
              .fontSize(14)
              .fontColor('#999999')
              .width('100%')
              .margin({ bottom: 8 })

            TextArea({ placeholder: 'æè¿°è¿™ä¸ªæ•°å­—äººçš„ç‰¹ç‚¹å’Œç”¨é€”...' })
              .backgroundColor('#f5f5f5')
              .borderRadius(8)
              .height(120)
              .onChange((value: string) => {
                this.description = value;
              })
          }
          .width('100%')
          .padding(20)
          .backgroundColor(Color.White)
          .borderRadius(16)
          .margin({ top: 16 })
          .alignItems(HorizontalAlign.Start)

          // ç‰¹æ€§é€‰æ‹©å¡ç‰‡
          Column() {
            Text('ç‰¹æ€§æ ‡ç­¾')
              .fontSize(14)
              .fontColor('#999999')
              .width('100%')
              .margin({ bottom: 12 })

            Flex({ wrap: FlexWrap.Wrap }) {
              this.TagButton('ä¸“ä¸šçŸ¥è¯†')
              this.TagButton('äº²åˆ‡å‹å¥½')
              this.TagButton('å¹½é»˜é£è¶£')
              this.TagButton('ä¸¥è°¨è®¤çœŸ')
              this.TagButton('åˆ›æ„æ— é™')
              this.TagButton('è€å¿ƒç»†è‡´')
            }
          }
          .width('100%')
          .padding(20)
          .backgroundColor(Color.White)
          .borderRadius(16)
          .margin({ top: 16 })
          .alignItems(HorizontalAlign.Start)

          // åˆ›å»ºæŒ‰é’®
          Button('åˆ›å»ºæ•°å­—äºº')
            .fontSize(18)
            .fontWeight(FontWeight.Medium)
            .fontColor(Color.White)
            .backgroundColor('#6366f1')
            .width('100%')
            .height(52)
            .borderRadius(26)
            .margin({ top: 32, bottom: 32 })
            .enabled(this.avatarUri !== '' && this.name !== '')
            .opacity(this.avatarUri !== '' && this.name !== '' ? 1 : 0.5)
            .onClick(() => {
              console.info('åˆ›å»ºæ•°å­—äºº:', this.name, this.description, this.avatarUri);
              router.back();
            })
        }
        .width('90%')
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
      .backgroundColor('#f8f9fa')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f8f9fa')
  }

  @Builder TagButton(text: string) {
    Text(text)
      .fontSize(14)
      .fontColor('#6366f1')
      .backgroundColor('#e0e7ff')
      .borderRadius(16)
      .padding({ left: 16, right: 16, top: 8, bottom: 8 })
      .margin({ right: 8, bottom: 8 })
  }

  // é€‰æ‹©å›¾ç‰‡
  private selectImage() {
    // TODO: è°ƒç”¨ç³»ç»Ÿç›¸å†Œé€‰æ‹©å™¨
    // ç¤ºä¾‹ä»£ç ï¼ˆéœ€è¦å¯¼å…¥ç›¸å…³æ¨¡å—ï¼‰
    /*
    import picker from '@ohos.file.picker';

    let photoPicker = new picker.PhotoViewPicker();
    photoPicker.select({
      MIMEType: picker.PhotoViewMIMETypes.IMAGE_TYPE,
      maxSelectNumber: 1
    }).then((result) => {
      if (result.photoUris.length > 0) {
        this.avatarUri = result.photoUris[0];
      }
    });
    */

    // ä¸´æ—¶æ¼”ç¤ºï¼ˆå®é™…ä½¿ç”¨æ—¶åˆ é™¤ï¼‰
    this.avatarUri = 'file://path/to/image.jpg';
  }

  // æ‹ç…§
  private takePhoto() {
    // TODO: è°ƒç”¨ç³»ç»Ÿç›¸æœº
    // ç¤ºä¾‹ä»£ç 
    /*
    import camera from '@ohos.multimedia.camera';
    // å®ç°æ‹ç…§é€»è¾‘
    */

    // ä¸´æ—¶æ¼”ç¤º
    this.avatarUri = 'file://path/to/photo.jpg';
  }
}
